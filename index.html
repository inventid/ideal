<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Ideal : Ruby 2.1.2 compatible iDealv3 payment gateway">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Ideal</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/inventid/ideal">View on GitHub</a>

          <h1 id="project_title">Ideal</h1>
          <h2 id="project_tagline">Ruby 2.1.2 compatible iDealv3 payment gateway</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/inventid/ideal/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/inventid/ideal/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p><a href="http://opensource.inventid.nl"><img src="https://s3-eu-west-1.amazonaws.com/static-inventid-nl/content/img/logo.png" alt="inventid logo"></a></p>

<h1>
<a name="ideal" class="anchor" href="#ideal"><span class="octicon octicon-link"></span></a>Ideal</h1>

<table>
<thead><tr>
<th>Branch</th>
<th>Build status</th>
<th>Code coverage</th>
</tr></thead>
<tbody>
<tr>
<td>Master</td>
<td><a href="https://travis-ci.org/inventid/ideal"><img src="https://travis-ci.org/inventid/ideal.svg?branch=master" alt="Build Status"></a></td>
<td><a href="https://coveralls.io/r/inventid/ideal?branch=master"><img src="http://img.shields.io/coveralls/inventid/ideal/master.svg" alt="Coverage Status"></a></td>
</tr>
<tr>
<td>Develop</td>
<td><a href="https://travis-ci.org/inventid/ideal"><img src="https://travis-ci.org/inventid/ideal.svg?branch=develop" alt="Build Status"></a></td>
<td><a href="https://coveralls.io/r/inventid/ideal?branch=develop"><img src="http://img.shields.io/coveralls/inventid/ideal/develop.svg" alt="Coverage Status"></a></td>
</tr>
</tbody>
</table><h2>
<a name="what-is-it" class="anchor" href="#what-is-it"><span class="octicon octicon-link"></span></a>What is it?</h2>

<p>Ideal is a simple Ruby 2.1 compliant gateway to contact any banks using the Dutch iDeal protocol.
Since there was no decent one available, we decided to develop our own.
And now you can use it too!</p>

<h2>
<a name="how-to-use-it" class="anchor" href="#how-to-use-it"><span class="octicon octicon-link"></span></a>How to use it?</h2>

<p>Using it is quite simple, you can simply clone the code and then require it (<em>we plan to release a gem later</em>).</p>

<h3>
<a name="preparing-certificates" class="anchor" href="#preparing-certificates"><span class="octicon octicon-link"></span></a>Preparing certificates</h3>

<p>iDeal requires client certificates.
You have to generate these yourself (or buy one from a Certificate Authority, but that's just wasting money in this case).
Additionally you need the certificate from your acquirer, which is supplied through their dashboard.</p>

<p>The following code generates the certificate and key.
Replace <em>PASSWORD</em> with your actual password.</p>

<div class="highlight highlight-bash"><pre>openssl genrsa -aes128 -out private.key -passout pass:PASSWORD 2048
openssl req -x509 -new -key private.key -passin pass:PASSWORD -days <span class="m">1825</span> -out certificate.cer
</pre></div>

<h3>
<a name="using-a-fixture" class="anchor" href="#using-a-fixture"><span class="octicon octicon-link"></span></a>Using a fixture</h3>

<p>Fixtures are a great way not to have all these constants in your code, a server administrator may even override them with tools as Puppet.</p>

<p>The fixture is equal to the one in the test.</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">acquirer</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rabobank</span>
  <span class="l-Scalar-Plain">merchant_id</span><span class="p-Indicator">:</span> <span class="s">'002054205'</span>
  <span class="l-Scalar-Plain">passphrase</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">wachtwoord</span>
  <span class="l-Scalar-Plain">private_key_file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">../certs/bestandsnaam.key</span>
  <span class="l-Scalar-Plain">private_certificate_file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">../certs/bestandsnaam.cer</span>
  <span class="l-Scalar-Plain">ideal_certificate_file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">../certs/ideal.cer</span>
</pre></div>

<p>which can be later loaded with the following code</p>

<div class="highlight highlight-ruby"><pre><span class="n">file</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">),</span> <span class="s1">'fixtures.yml'</span><span class="p">)</span>
<span class="n">fixtures</span> <span class="o">||=</span> <span class="no">YAML</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
<span class="n">fixture</span> <span class="o">=</span> <span class="n">fixtures</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">||</span> <span class="k">raise</span><span class="p">(</span><span class="no">StandardError</span><span class="p">,</span> <span class="s2">"No fixture data was found for key '</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">passphrase</span> <span class="o">=</span> <span class="n">fixture</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'passphrase'</span><span class="p">)</span>
  <span class="no">Ideal</span><span class="o">::</span><span class="no">Gateway</span><span class="o">.</span><span class="n">passphrase</span> <span class="o">=</span> <span class="n">passphrase</span>
<span class="k">end</span>
<span class="n">fixture</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span> <span class="no">Ideal</span><span class="o">::</span><span class="no">Gateway</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">="</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="p">}</span>
</pre></div>

<h3>
<a name="not-using-a-fixture" class="anchor" href="#not-using-a-fixture"><span class="octicon octicon-link"></span></a>Not using a fixture</h3>

<p>Well, also an option.
Codewise it might even be a bit cleaner <img class="emoji" title=":wink:" alt=":wink:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f609.png" height="20" width="20" align="absmiddle"> although deployment is harder</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># Other banks preloaded are :abnamro and :rabobank</span>
<span class="no">Ideal</span><span class="o">::</span><span class="no">Gateway</span><span class="o">.</span><span class="n">acquirer</span> <span class="o">=</span> <span class="ss">:ing</span>
<span class="no">Ideal</span><span class="o">::</span><span class="no">Gateway</span><span class="o">.</span><span class="n">merchant_id</span> <span class="o">=</span> <span class="s1">'00123456789'</span>

<span class="c1"># Maybe you'd like another location</span>
<span class="n">ideal_directory</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s1">'config/ideal'</span>
<span class="no">Ideal</span><span class="o">::</span><span class="no">Gateway</span><span class="o">.</span><span class="n">passphrase</span> <span class="o">=</span> <span class="s1">'the_passphrase'</span>
<span class="no">Ideal</span><span class="o">::</span><span class="no">Gateway</span><span class="o">.</span><span class="n">private_key_file</span>         <span class="o">=</span> <span class="n">ideal_directory</span> <span class="o">+</span> <span class="s1">'private_key.pem'</span>
<span class="no">Ideal</span><span class="o">::</span><span class="no">Gateway</span><span class="o">.</span><span class="n">private_certificate_file</span> <span class="o">=</span> <span class="n">ideal_directory</span> <span class="o">+</span> <span class="s1">'private_certificate.cer'</span>
<span class="no">Ideal</span><span class="o">::</span><span class="no">Gateway</span><span class="o">.</span><span class="n">ideal_certificate_file</span>   <span class="o">=</span> <span class="n">ideal_directory</span> <span class="o">+</span> <span class="s1">'ideal.cer'</span>
</pre></div>

<h3>
<a name="getting-a-list-of-issuers" class="anchor" href="#getting-a-list-of-issuers"><span class="octicon octicon-link"></span></a>Getting a list of issuers</h3>

<p>This does the explicit call to your acquirer.
Since the list of issuers hardly ever changes, you could better (performance-wise) cache the result for 48 hours.</p>

<div class="highlight highlight-ruby"><pre><span class="no">Ideal</span><span class="o">::</span><span class="no">Gateway</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">issuers</span><span class="o">.</span><span class="n">list</span>
</pre></div>

<h3>
<a name="requesting-a-payment" class="anchor" href="#requesting-a-payment"><span class="octicon octicon-link"></span></a>Requesting a payment</h3>

<p>For this we need to send a Transaction Request to our acquirer with the following code</p>

<div class="highlight highlight-ruby"><pre><span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1"># The customer has 30 minutes to complete the iDeal transaction (ISO 8601)</span>
  <span class="ss">:expiration_period</span> <span class="o">=&gt;</span> <span class="s2">"PT30M"</span><span class="p">,</span>
  <span class="ss">:issuer_id</span>         <span class="o">=&gt;</span> <span class="n">issuer_id</span><span class="p">,</span>
  <span class="ss">:return_url</span>        <span class="o">=&gt;</span> <span class="n">return_url</span><span class="p">,</span>
  <span class="ss">:order_id</span>          <span class="o">=&gt;</span> <span class="s1">'14'</span><span class="p">,</span>
  <span class="ss">:description</span>       <span class="o">=&gt;</span> <span class="s1">'Probably awesomeness'</span><span class="p">,</span>
  <span class="ss">:entrance_code</span>     <span class="o">=&gt;</span> <span class="s1">'secretCode'</span>
<span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">ideal</span><span class="o">.</span><span class="n">setup_purchase</span><span class="p">(</span><span class="mi">5</span><span class="o">.</span><span class="mo">00</span> <span class="p">,</span> <span class="n">ideal_attributes</span><span class="p">)</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">success?</span>
  <span class="c1"># Save the data, then redirect</span>
  <span class="n">redirect_to</span> <span class="n">response</span><span class="o">.</span><span class="n">service_url</span>
<span class="k">else</span>
  <span class="c1"># Log something</span>
<span class="k">end</span>
</pre></div>

<h3>
<a name="requesting-the-payment-status" class="anchor" href="#requesting-the-payment-status"><span class="octicon octicon-link"></span></a>Requesting the payment status</h3>

<p>The merchant has the obligation to request a final status once the timeout has expired.</p>

<div class="highlight highlight-ruby"><pre><span class="n">status</span> <span class="o">=</span> <span class="n">ideal</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>
<span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">success?</span>
  <span class="c1"># Save the data as paid</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="how-to-suggest-improvements" class="anchor" href="#how-to-suggest-improvements"><span class="octicon octicon-link"></span></a>How to suggest improvements?</h2>

<p>We are still actively developing Ideal for our internal use, but we would already love to hear your feedback. In case you have some great ideas, you may just <a href="https://github.com/inventid/ideal/issues/new">open an issue</a>. Be sure to check beforehand whether the same issue does not already exist.</p>

<h2>
<a name="how-can-i-contribute" class="anchor" href="#how-can-i-contribute"><span class="octicon octicon-link"></span></a>How can I contribute?</h2>

<p>We feel contributions from the community are extremely worthwhile. If you use Ideal in production and make some modification, please share it back to the community. You can simply <a href="https://github.com/inventid/ideal/fork">fork the repository</a>, commit your changes to your code and create a pull request back to this repository.</p>

<p>If there are any issues related to your changes, be sure to reference to those. Additionally we use the <code>develop</code> branch, so create a pull request to that branch and not to <code>master</code>.</p>

<p>Additionally we always use <a href="http://www.vagrantup.com">vagrant</a> for our development. To do the same, you can do the following:</p>

<ol>
<li>Make sure to have <a href="http://www.vagrantup.com">vagrant</a> installed.</li>
<li>Clone the repository</li>
<li>Open a terminal / shell script and nagivate to the place where you cloned the repository</li>
<li>Simply enter <code>vagrant up</code>
</li>
<li>Provisioning takes around 5 minutes on my PC. If you want it to be faster you can use the userConfig.json file in the root and override the specific settings for memory and CPU.</li>
<li>The Vagrant machine provisions and you can easily work with us. Enter <code>vagrant ssh</code> to get shell access to the machine. In case you are done with it, simply enter <code>vagrant destroy</code>. You won't lose any changes to your git repository when this happens.</li>
</ol><h2>
<a name="collaborators" class="anchor" href="#collaborators"><span class="octicon octicon-link"></span></a>Collaborators</h2>

<p>We would like to thank the developers which contributed to Ideal, both big and small.</p>

<ul>
<li>
<a href="https://github.com/rogierslag">rogierslag</a> (Lead developer of Ideal @ <a href="https://www.inventid.nl">inventid</a>)</li>
<li>
<a href="https://github.com/joostverdoorn">joostverdoorn</a> (Developer of Ideal @ <a href="https://www.inventid.nl">inventid</a>)</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Ideal maintained by <a href="https://github.com/inventid">inventid</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
